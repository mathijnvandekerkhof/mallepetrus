spring:
  application:
    name: jiptv
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:jiptv}
    username: ${DB_USER:jiptv}
    password: ${DB_PASSWORD:jiptv_dev_password}
    driver-class-name: org.postgresql.Driver
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
  
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
  
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:jiptv_redis_password}
      database: ${REDIS_DATABASE_GENERAL:0}
      timeout: 2000ms
      connect-timeout: 2000ms
  
  mail:
    host: ${BREVO_SMTP_HOST:}
    port: ${BREVO_SMTP_PORT:587}
    username: ${BREVO_SMTP_USER:}
    password: ${BREVO_SMTP_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

server:
  port: 8080
  servlet:
    context-path: /api

logging:
  level:
    nl.mallepetrus.jiptv: DEBUG
    org.springframework.security: DEBUG
    org.springframework.data.redis.repository.support: ERROR
    org.springframework.data.redis.repository.config: ERROR
    org.springframework.data.repository.config: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

jiptv:
  jwt:
    secret: ${JWT_SECRET:dev_jwt_secret_key_change_in_production_this_is_for_local_development_only_and_must_be_at_least_256_bits_long_for_security_purposes_so_this_should_be_sufficient}
    expiration: 86400000 # 24 hours
    refresh-expiration: 604800000 # 7 days
  
  mfa:
    issuer: ${MFA_ISSUER:JIPTV}
  
  zero-trust:
    enabled: ${ZERO_TRUST_ENABLED:true}
    risk-threshold: ${ZERO_TRUST_RISK_THRESHOLD:75}
    max-devices: ${ZERO_TRUST_MAX_DEVICES:5}
  
  redis:
    database:
      general: ${REDIS_DATABASE_GENERAL:0}
      zero-trust: ${REDIS_DATABASE_ZEROTRUST:1}
      rate-limit: ${REDIS_DATABASE_RATELIMIT:2}
  
  domains:
    admin: ${ADMIN_DOMAIN:admin.mallepetrus.nl}
    user: ${USER_DOMAIN:users.mallepetrus.nl}
    api: ${API_DOMAIN:api.mallepetrus.nl}
  
  mail:
    from: ${MAIL_FROM:noreply@mallepetrus.nl}
  
  # FFmpeg and transcoding configuration
  ffmpeg:
    path: ${FFMPEG_PATH:ffmpeg}
    ffprobe-path: ${FFPROBE_PATH:ffprobe}
    timeout: ${FFMPEG_TIMEOUT:3600}
  
  transcoding:
    output-dir: ${TRANSCODING_OUTPUT_DIR:./transcoded}
    hls-segment-duration: ${HLS_SEGMENT_DURATION:6}
    timeout: ${TRANSCODING_TIMEOUT:3600}
    max-concurrent-jobs: ${TRANSCODING_MAX_CONCURRENT_JOBS:2}
    job-timeout-hours: ${TRANSCODING_JOB_TIMEOUT_HOURS:4}
    cleanup-days: ${TRANSCODING_CLEANUP_DAYS:7}
  
  stream:
    metadata:
      cache-ttl: ${STREAM_METADATA_CACHE_TTL:86400} # 24 hours
      url-cache-ttl: ${STREAM_URL_CACHE_TTL:1800}   # 30 minutes
      preferences-cache-ttl: ${STREAM_PREFERENCES_CACHE_TTL:3600} # 1 hour

# Actuator configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
  health:
    mail:
      enabled: false  # Disable mail health check for development
    redis:
      enabled: false  # Disable Redis health check for now